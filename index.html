<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024">
  <title>Invoice Generator - Reference Format</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <h1>Automatic Invoice Maker</h1>
  <form onsubmit="generateInvoice(event)">
    <fieldset>
      <legend>Invoice Details</legend>
      <div class="form-group"><label for="invoice-number">Invoice Number:</label><input type="text" id="invoice-number" required></div>
      <div class="form-group"><label for="invoice-date">Invoice Date:</label><input type="date" id="invoice-date" required></div>
      <div class="form-group"><label for="vehicle-no">Vehicle Number (optional):</label><input type="text" id="vehicle-no"></div>
      <div class="form-group"><label for="reverse-charge">Reverse Charge (optional):</label><input type="text" id="reverse-charge"></div>
      <div class="form-group"><label for="challan-no">Challan Number (optional):</label><input type="text" id="challan-no"></div>
      <div class="form-group"><label for="date-of-supply">Date of Supply (optional):</label><input type="date" id="date-of-supply"></div>
      <div class="form-group"><label for="place-of-supply">Place of Supply (optional):</label><input type="text" id="place-of-supply"></div>
      <div class="form-group"><label for="transporter-name">Transporter Name (optional):</label><input type="text" id="transporter-name"></div>
      <div class="form-group"><label for="lr-number">LR Number (optional):</label><input type="text" id="lr-number"></div>
    </fieldset>

    <fieldset>
      <legend>Customer Details</legend>
      <div class="form-group"><label for="customer-name">Customer Name:</label><input type="text" id="customer-name"></div>
      <div class="form-group"><label for="billing-address">Billing Address:</label><input type="text" id="billing-address"></div>
      <div class="form-group"><label for="shipping-address">Shipping Address:</label><input type="text" id="shipping-address"></div>
    </fieldset>

    <fieldset>
      <legend>Invoice Items</legend>
      <div id="product-container">
        <div class="product-item">
          <div class="form-group"><label>Item Name:</label><input type="text" class="item-name"></div>
          <div class="form-group"><label>HSN:</label><input type="text" class="item-hsn"></div>
          <div class="form-group"><label>Qty:</label><input type="number" class="item-qty"></div>
          <div class="form-group"><label>Unit:</label><input type="text" class="item-unit"></div>
          <div class="form-group"><label>Rate:</label><input type="number" class="item-rate"></div>
          <div class="form-group"><label>GST %:</label><input type="number" class="item-gst"></div>
        </div>
      </div>
      <button type="button" onclick="addProductFields()">Add Another Product</button>
    </fieldset>

    <fieldset>
      <legend>Freight Charges</legend>
      <div class="form-group"><label for="freight">Freight Amount:</label><input type="number" id="freight"></div>
    </fieldset>

    <button type="submit">Generate Invoice</button>
  </form>

  <button id="download-button" onclick="downloadPDF()">Download PDF</button>

  <script>
    function addProductFields() {
      const container = document.getElementById('product-container');
      const block = document.createElement('div');
      block.className = 'product-item';
      block.innerHTML = `
        <div class="form-group"><label>Item Name:</label><input type="text" class="item-name"></div>
        <div class="form-group"><label>HSN:</label><input type="text" class="item-hsn"></div>
        <div class="form-group"><label>Qty:</label><input type="number" class="item-qty"></div>
        <div class="form-group"><label>Unit:</label><input type="text" class="item-unit"></div>
        <div class="form-group"><label>Rate:</label><input type="number" class="item-rate"></div>
        <div class="form-group"><label>GST %:</label><input type="number" class="item-gst"></div>`;
      container.appendChild(block);
    }

    async function generateInvoice(event) {
      event.preventDefault();
      document.getElementById('download-button').style.display = 'block';
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      const invoiceNo = document.getElementById('invoice-number').value;
      const invoiceDate = document.getElementById('invoice-date').value;
      const vehicleNo = document.getElementById('vehicle-no').value;
      const reverseCharge = document.getElementById('reverse-charge').value;
      const challanNo = document.getElementById('challan-no').value;
      const dateOfSupply = document.getElementById('date-of-supply').value;
      const placeOfSupply = document.getElementById('place-of-supply').value;
      const transporterName = document.getElementById('transporter-name').value;
      const lrNumber = document.getElementById('lr-number').value;

      const customerName = document.getElementById('customer-name').value;
      const billingAddress = document.getElementById('billing-address').value;
      const shippingAddress = document.getElementById('shipping-address').value;

      const logo = new Image();
      logo.src = '893e665f-85de-44ef-aeaf-99f25fa4fa4d.png';
      logo.onload = () => {
        doc.addImage(logo, 'PNG', 80, 4, 50, 20);
        doc.setFontSize(10);
        doc.text("TAX INVOICE", 85, 30);
        doc.text(`Invoice No: ${invoiceNo}`, 10, 38);
        doc.text(`Invoice Date: ${invoiceDate}`, 150, 38);

        let y = 44;
        if (vehicleNo) doc.text(`Vehicle No: ${vehicleNo}`, 10, y);
        if (reverseCharge) doc.text(`Reverse Charge: ${reverseCharge}`, 150, y);
        y += 6;
        if (challanNo) doc.text(`Challan No: ${challanNo}`, 10, y);
        if (dateOfSupply) doc.text(`Date of Supply: ${dateOfSupply}`, 150, y);
        y += 6;
        if (placeOfSupply) doc.text(`Place of Supply: ${placeOfSupply}`, 10, y);
        if (transporterName) doc.text(`Transporter Name: ${transporterName}`, 150, y);
        y += 6;
        if (lrNumber) doc.text(`LR Number: ${lrNumber}`, 10, y);

        y += 10;
        doc.text(`Billed To: ${customerName}`, 10, y);
        doc.text(`Billing Address: ${billingAddress}`, 10, y + 6);
        doc.text(`Shipping Address: ${shippingAddress}`, 10, y + 12);

        const items = document.querySelectorAll('.product-item');
        const rows = [];
        items.forEach((el, i) => {
          const name = el.querySelector('.item-name').value;
          const hsn = el.querySelector('.item-hsn').value;
          const qty = el.querySelector('.item-qty').value;
          const unit = el.querySelector('.item-unit').value;
          const rate = parseFloat(el.querySelector('.item-rate').value);
          const gst = parseFloat(el.querySelector('.item-gst').value);
          const taxable = (qty * rate).toFixed(2);
          const gstAmt = ((taxable * gst) / 100).toFixed(2);
          const total = (parseFloat(taxable) + parseFloat(gstAmt)).toFixed(2);
          rows.push([i + 1, name, hsn, qty, unit, rate, taxable, gst + '%', gstAmt, total]);
        });

        const freight = parseFloat(document.getElementById('freight').value) || 0;
        const freightGst = (freight * 0.18).toFixed(2);
        const freightTotal = (freight + parseFloat(freightGst)).toFixed(2);
        if (freight > 0) {
          rows.push(['', 'Freight Charges', '', '', '', '', freight.toFixed(2), '18%', freightGst, freightTotal]);
        }

        doc.autoTable({
          startY: y + 20,
          head: [["Sr", "Name", "HSN", "Qty", "Unit", "Rate", "Taxable", "GST %", "GST Amt", "Total"]],
          body: rows,
          styles: { fontSize: 8 },
          headStyles: { fillColor: [22, 160, 133] }
        });

        const fy = doc.lastAutoTable.finalY + 10;
        doc.text("Certified that the particulars given above are true and correct.", 10, fy);
        doc.text("Authorised Signatory", 150, fy + 10);

        doc.text("Terms and Conditions:", 10, fy + 20);
        doc.text("1. This is an electronically generated document.", 10, fy + 26);
        doc.text("2. All disputes are subject to Pune jurisdiction.", 10, fy + 32);
        doc.text("3. Payment to be cleared within 0 days from invoice date.", 10, fy + 38);

        doc.save("invoice.pdf");
      };
    }
  </script>
</body>
</html>
