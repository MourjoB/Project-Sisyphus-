<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=1024">
  <title>Purple Bean Agro Invoice Generator</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <div class="container">
    <img src="893e665f-85de-44ef-aeaf-99f25fa4fa4d.png" alt="Purple Bean Logo" style="max-width: 150px; display: block; margin: 0 auto;">
    <h1>Purple Bean Agro Industries Pvt. Ltd.</h1>
    <p style="text-align: center; margin: 0;">PBAI Pvt Ltd, Nr. Dapodi Metro Station, Dapodi, Pune, Maharashtra 411012</p>
    <p style="text-align: center; margin: 0;">Phone: 8101287339 | Email: purplebeanagro@gmail.com</p>
    <p style="text-align: center; margin: 0;">GSTIN: 27AIPPD4664G1Z2 | PAN: AAPCP3820M</p>
    <h2 style="text-align: center;">TAX INVOICE</h2>

    <form onsubmit="generateInvoice(event)">
      <fieldset>
        <legend>Invoice Details</legend>
        <div class="form-group"><label for="invoice-number">Invoice Number:</label><input type="text" id="invoice-number" required></div>
        <div class="form-group"><label for="invoice-date">Invoice Date:</label><input type="date" id="invoice-date" required></div>
        <div class="form-group"><label for="vehicle-no">Vehicle Number (optional):</label><input type="text" id="vehicle-no"></div>
        <div class="form-group"><label for="reverse-charge">Reverse Charge (optional):</label><input type="text" id="reverse-charge"></div>
        <div class="form-group"><label for="challan-no">Challan Number (optional):</label><input type="text" id="challan-no"></div>
        <div class="form-group"><label for="date-of-supply">Date of Supply (optional):</label><input type="date" id="date-of-supply"></div>
        <div class="form-group"><label for="place-of-supply">Place of Supply (optional):</label><input type="text" id="place-of-supply"></div>
        <div class="form-group"><label for="transporter-name">Transporter Name (optional):</label><input type="text" id="transporter-name"></div>
        <div class="form-group"><label for="lr-number">LR Number (optional):</label><input type="text" id="lr-number"></div>
      </fieldset>

      <fieldset>
        <legend>Customer Details</legend>
        <div class="form-group"><label for="customer-name">Customer Name:</label><input type="text" id="customer-name"></div>
        <div class="form-group"><label for="customer-email">Customer Email:</label><input type="email" id="customer-email"></div>
        <div class="form-group"><label for="customer-phone">Customer Phone:</label><input type="tel" id="customer-phone"></div>
        <div class="form-group"><label for="billing-address">Billing Address:</label><input type="text" id="billing-address"></div>
        <div class="form-group"><input type="checkbox" id="same-address" checked> <label for="same-address">Shipping same as Billing</label></div>
        <div id="shipping-details" style="display: none;">
          <div class="form-group"><label for="shipping-name">Shipping Name:</label><input type="text" id="shipping-name"></div>
          <div class="form-group"><label for="shipping-email">Shipping Email:</label><input type="email" id="shipping-email"></div>
          <div class="form-group"><label for="shipping-phone">Shipping Phone:</label><input type="tel" id="shipping-phone"></div>
          <div class="form-group"><label for="shipping-address">Shipping Address:</label><input type="text" id="shipping-address"></div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Invoice Items</legend>
        <div id="product-container">
          <div class="product-item">
            <div class="form-group">
              <label>Item Name:</label>
              <select class="product-dropdown" required>
                <option value="" disabled selected>Select a product</option>
              </select>
            </div>
            <div class="form-group"><label>Quantity:</label><input type="number" class="item-qty" required></div>
            <div class="form-group"><label>Rate:</label><input type="number" class="item-rate" step="0.01" required></div>
            <div class="form-group"><label>HSN:</label><input type="text" class="item-hsn" readonly></div>
            <div class="form-group"><label>Unit:</label><input type="text" class="item-unit" readonly></div>
            <div class="form-group"><label>GST %:</label><input type="text" class="item-gst" readonly></div>
          </div>
        </div>
        <button type="button" onclick="addProductFields()">Add Another Product</button>
      </fieldset>

      <fieldset>
        <legend>Additional Charges</legend>
        <div class="form-group"><label for="freight">Freight Charges:</label><input type="number" id="freight"></div>
      </fieldset>

      <button type="submit">Generate Invoice</button>
    </form>
    <button id="download-button" onclick="downloadPDF()" style="display: none;">Download PDF</button>
  </div>

  <script>
    document.getElementById('same-address').addEventListener('change', function () {
      document.getElementById('shipping-details').style.display = this.checked ? 'none' : 'block';
    });

    function addProductFields() {
      const container = document.getElementById('product-container');
      const block = container.firstElementChild.cloneNode(true);
      block.querySelectorAll('input').forEach(input => input.value = '');
      block.querySelector('select').selectedIndex = 0;
      container.appendChild(block);
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const res = await fetch('products.json');
      const data = await res.json();
      window.productDetails = data;
      document.querySelectorAll('.product-dropdown').forEach(dropdown => {
        data.forEach(p => {
          const option = document.createElement('option');
          option.value = p.name;
          option.textContent = `${p.name} (${p.unit})`;
          dropdown.appendChild(option);
        });
        $(dropdown).select2();
        dropdown.addEventListener('change', function () {
          const selected = data.find(p => p.name === this.value);
          const wrapper = this.closest('.product-item');
          wrapper.querySelector('.item-hsn').value = selected.hsn;
          wrapper.querySelector('.item-unit').value = selected.unit;
          wrapper.querySelector('.item-gst').value = selected.gstRate;
          wrapper.querySelector('.item-rate').value = selected.price;
        });
      });
    });
  </script>
</body>
</html>
