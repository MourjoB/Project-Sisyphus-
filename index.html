<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024">
    <title>Invoice Generator - PDF Text Version</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <h1>Automatic Invoice Maker</h1>
    <form onsubmit="generateInvoice(event)">
        <fieldset>
            <legend>Invoice Details</legend>
            <div class="form-group">
                <label for="invoice-number">Invoice Number:</label>
                <input type="text" id="invoice-number" required>
            </div>
        </fieldset>
        <fieldset>
            <legend>Customer Details</legend>
            <div class="form-group">
                <label for="customer-name">Customer Name:</label>
                <input type="text" id="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-email">Email:</label>
                <input type="email" id="customer-email">
            </div>
            <div class="form-group">
                <label for="customer-phone">Phone:</label>
                <input type="tel" id="customer-phone">
            </div>
            <div class="form-group">
                <label for="billing-address">Billing Address:</label>
                <input type="text" id="billing-address" required>
            </div>
            <div class="form-group">
                <input type="checkbox" id="same-address" checked>
                <label for="same-address">Shipping address same as billing</label>
            </div>
            <div id="shipping-fields" style="display: none;">
                <div class="form-group">
                    <label for="shipping-name">Shipping Name:</label>
                    <input type="text" id="shipping-name">
                </div>
                <div class="form-group">
                    <label for="shipping-email">Shipping Email:</label>
                    <input type="email" id="shipping-email">
                </div>
                <div class="form-group">
                    <label for="shipping-phone">Shipping Phone:</label>
                    <input type="tel" id="shipping-phone">
                </div>
                <div class="form-group">
                    <label for="shipping-address">Shipping Address:</label>
                    <input type="text" id="shipping-address">
                </div>
            </div>
        </fieldset>
        <fieldset>
            <legend>Invoice Items</legend>
            <div id="product-container">
                <div class="product-item">
                    <div class="form-group">
                        <label>Item Name:</label>
                        <select name="item-name[]" class="product-dropdown" required></select>
                    </div>
                    <div class="form-group">
                        <label>Quantity:</label>
                        <input type="number" name="item-quantity[]" required>
                    </div>
                    <div class="form-group">
                        <label>Price:</label>
                        <input type="number" name="item-price[]" step="0.01" required>
                    </div>
                </div>
            </div>
            <button type="button" onclick="addProductFields()">Add Another Product</button>
        </fieldset>
        <fieldset>
            <legend>Additional Charges</legend>
            <div class="form-group">
                <label for="freight-charges">Freight Charges:</label>
                <input type="number" id="freight-charges" step="0.01">
            </div>
        </fieldset>
        <button type="submit">Generate Invoice</button>
    </form>
    <button id="download-button" onclick="downloadPDF()">Download PDF</button>

    <script>
        function addProductFields() {
            const container = document.getElementById('product-container');
            const productFields = `
                <div class="product-item">
                    <div class="form-group">
                        <label>Item Name:</label>
                        <select name="item-name[]" class="product-dropdown" required></select>
                    </div>
                    <div class="form-group">
                        <label>Quantity:</label>
                        <input type="number" name="item-quantity[]" required>
                    </div>
                    <div class="form-group">
                        <label>Price:</label>
                        <input type="number" name="item-price[]" step="0.01" required>
                    </div>
                </div>`;
            container.insertAdjacentHTML('beforeend', productFields);
            populateDropdowns();
        }

        function populateDropdowns() {
            const selects = document.querySelectorAll('.product-dropdown');
            selects.forEach(select => {
                if (select.options.length <= 1) {
                    select.innerHTML = '<option value="" disabled selected>Select a product</option>' +
                        window.productDetails.map(p => `<option value="${p.name}">${p.name} (${p.unit})</option>`).join('');
                }
            });
            $('.product-dropdown').select2();
        }

        document.getElementById('same-address').addEventListener('change', function () {
            document.getElementById('shipping-fields').style.display = this.checked ? 'none' : 'block';
        });

        async function generateInvoice(event) {
            event.preventDefault();
            document.getElementById('download-button').style.display = 'block';
        }

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const billingAddress = document.getElementById('billing-address').value;

            let shippingName = customerName;
            let shippingEmail = customerEmail;
            let shippingPhone = customerPhone;
            let shippingAddress = billingAddress;

            if (!document.getElementById('same-address').checked) {
                shippingName = document.getElementById('shipping-name').value;
                shippingEmail = document.getElementById('shipping-email').value;
                shippingPhone = document.getElementById('shipping-phone').value;
                shippingAddress = document.getElementById('shipping-address').value;
            }

            doc.setFontSize(14);
            doc.text("Purple Bean Agro Industries Pvt. Ltd.", 10, 10);
            doc.setFontSize(10);
            doc.text("PBAI Pvt Ltd, nr. Dapodi Metro Station, Dapodi, Pune, Maharashtra 411012", 10, 16);
            doc.text("Phone: 8101287339 | Email: purplebeanagro@gmail.com", 10, 22);
            doc.text("GST: 27AIPPD4664G1Z2 | PAN: AAPCP3820M", 10, 28);

            doc.setFontSize(12);
            doc.text("TAX INVOICE", 85, 38);

            doc.setFontSize(10);
            doc.text(`Invoice Number: ${document.getElementById('invoice-number').value}`, 10, 48);
            doc.text(`Invoice Date: ${new Date().toLocaleDateString()}`, 150, 48);

            doc.text(`Billing Name: ${customerName}`, 10, 56);
            doc.text(`Email: ${customerEmail}`, 10, 61);
            doc.text(`Phone: ${customerPhone}`, 10, 66);
            doc.text(`Billing Address: ${billingAddress}`, 10, 71);

            doc.text(`Shipping Name: ${shippingName}`, 10, 80);
            doc.text(`Email: ${shippingEmail}`, 10, 85);
            doc.text(`Phone: ${shippingPhone}`, 10, 90);
            doc.text(`Shipping Address: ${shippingAddress}`, 10, 95);

            const productItems = document.querySelectorAll('.product-item');
            const rows = [];

            productItems.forEach((item, index) => {
                const name = item.querySelector('[name="item-name[]"]').value;
                const qty = item.querySelector('[name="item-quantity[]"]').value;
                const price = item.querySelector('[name="item-price[]"]').value;
                const product = window.productDetails.find(p => p.name === name);

                const unit = product.unit;
                const hsn = product.hsn;
                const gst = product.gstRate;
                const taxable = (qty * price).toFixed(2);
                const gstAmt = ((taxable * gst) / 100).toFixed(2);
                const total = (parseFloat(taxable) + parseFloat(gstAmt)).toFixed(2);

                rows.push([index + 1, name, hsn, qty, unit, price, taxable, `${gst}%`, gstAmt, total]);
            });

            const freight = parseFloat(document.getElementById('freight-charges').value) || 0;
            if (freight > 0) {
                const gstAmt = (freight * 0.18).toFixed(2);
                const total = (freight + parseFloat(gstAmt)).toFixed(2);
                rows.push(['', 'Freight Charges', '', '', '', '', freight.toFixed(2), '18%', gstAmt, total]);
            }

            doc.autoTable({
                startY: 105,
                head: [[
                    'Sr. No', 'Name of Product', 'HSN/SAC', 'QTY', 'Unit', 'Rate',
                    'Taxable Value', 'GST Rate', 'GST Amount', 'Total'
                ]],
                body: rows,
                styles: { fontSize: 8 },
                headStyles: { fillColor: [0, 123, 255] }
            });

            doc.text("Bank Details:", 10, doc.lastAutoTable.finalY + 10);
            doc.text("Acc Holder Name: Purple Bean Agro Industries Pvt. Ltd.", 10, doc.lastAutoTable.finalY + 16);
            doc.text("Bank Account Number: 10227953860", 10, doc.lastAutoTable.finalY + 22);
            doc.text("Bank IFSC Code: IDFB0041438", 10, doc.lastAutoTable.finalY + 28);
            doc.text("Bank Name: IDFC FIRST Bank", 10, doc.lastAutoTable.finalY + 34);
            doc.text("Bank Branch Name: CHAKAN BRANCH", 10, doc.lastAutoTable.finalY + 40);

            doc.save("invoice.pdf");
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const response = await fetch('products.json');
            const products = await response.json();
            window.productDetails = products;
            populateDropdowns();
        });
    </script>
</body>
</html>
