<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prototype-1</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        #invoice-container {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-family: Arial, sans-serif;
        }
        #invoice-container h2 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        #invoice-container p {
            margin: 5px 0;
            font-size: 1em;
            color: #555;
        }
        #invoice-container table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        #invoice-container th, #invoice-container td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        #invoice-container th {
            background-color: #f1f1f1;
            font-weight: bold;
        }
        #download-button {
            display: none;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
        }
        #download-button:hover {
            background-color: #0056b3;
        }
    </style>
    <script>
        function addProductFields() {
            const container = document.getElementById('product-container');
            const productFields = `
                <div class="product-item">
                    <div class="form-group">
                        <label for="item-name">Item Name:</label>
                        <select name="item-name[]" class="product-dropdown" required>
                            <option value="" disabled selected>Select a product</option>
                            <option value="Instant Coffee (SD)">Instant Coffee (SD)</option>
                            <option value="Instant Coffee (Agglo)">Instant Coffee (Agglo)</option>
                            <option value="Instant Coffee (FD)">Instant Coffee (FD)</option>
                            <option value="Coffee Premix">Coffee Premix</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="item-quantity">Quantity:</label>
                        <input type="number" name="item-quantity[]" required>
                    </div>
                    <div class="form-group">
                        <label for="item-price">Price:</label>
                        <input type="number" name="item-price[]" step="0.01" required>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', productFields);
            $('.product-dropdown').select2();
        }

        document.addEventListener('DOMContentLoaded', () => {
            $('.product-dropdown').select2();
        });

        async function generateInvoice(event) {
            event.preventDefault();

            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const address = document.getElementById('Address').value;
            const gstNumber = document.getElementById('gstnum').value;

            const productContainer = document.getElementById('product-container');
            const productItems = productContainer.querySelectorAll('.product-item');

            let invoiceHTML = `
                <h2>Invoice</h2>
                <p><strong>Name:</strong> ${customerName}</p>
                <p><strong>Email:</strong> ${customerEmail}</p>
                <p><strong>Phone:</strong> ${customerPhone}</p>
                <p><strong>Address:</strong> ${address}</p>
                <p><strong>GST Number:</strong> ${gstNumber}</p>
                <table>
                    <thead>
                        <tr>
                            <th>Item Name</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            productItems.forEach(item => {
                const itemName = item.querySelector('[name="item-name[]"]').value;
                const itemQuantity = item.querySelector('[name="item-quantity[]"]').value;
                const itemPrice = item.querySelector('[name="item-price[]"]').value;
                const total = (itemQuantity * itemPrice).toFixed(2);

                invoiceHTML += `
                    <tr>
                        <td>${itemName}</td>
                        <td>${itemQuantity}</td>
                        <td>${itemPrice}</td>
                        <td>${total}</td>
                    </tr>
                `;
            });

            invoiceHTML += `
                    </tbody>
                </table>
            `;

            const invoiceContainer = document.getElementById('invoice-container');
            invoiceContainer.innerHTML = invoiceHTML;

            const downloadButton = document.getElementById('download-button');
            downloadButton.style.display = 'block';
        }

        function downloadPDF() {
            const invoiceContainer = document.getElementById('invoice-container');
            const { jsPDF } = window.jspdf;

            html2canvas(invoiceContainer).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const doc = new jsPDF();
                const imgWidth = 190; // Fit image to page width
                const imgHeight = (canvas.height * imgWidth) / canvas.width; // Maintain aspect ratio

                doc.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                doc.save('invoice.pdf');
            });
        }
    </script>
</head>
<body>
    <h1>Automatic Invoice Maker</h1>
    <form onsubmit="generateInvoice(event)">
        <fieldset>
            <legend>Customer Details</legend>
            <div class="form-group">
                <label for="customer-name">Name:</label>
                <input type="text" id="customer-name" name="customer-name" required>
            </div>
            <div class="form-group">
                <label for="customer-email">Email:</label>
                <input type="email" id="customer-email" name="customer-email" required>
            </div>
            <div class="form-group">
                <label for="customer-phone">Phone:</label>
                <input type="tel" id="customer-phone" name="customer-phone">
            </div>
            <div class="form-group">
                <label for="address">Address:</label>
                <input type="text" name="Address" id="Address" required>
            </div>
            <div class="form-group">
                <label for="gstnum">GST Number:</label>
                <input type="text" name="gstnum" id="gstnum" required>
            </div>
        </fieldset>
        <fieldset>
            <legend>Invoice Items</legend>
            <div id="product-container">
                <div class="product-item">
                    <div class="form-group">
                        <label for="item-name">Item Name:</label>
                        <select name="item-name[]" class="product-dropdown" required>
                            <option value="" disabled selected>Select a product</option>
                            <option value="Instant Coffee (SD)">Instant Coffee (SD)</option>
                            <option value="Instant Coffee (Agglo)">Instant Coffee (Agglo)</option>
                            <option value="Instant Coffee (FD)">Instant Coffee (FD)</option>
                            <option value="Coffee Premix">Coffee Premix</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="item-quantity">Quantity:</label>
                        <input type="number" name="item-quantity[]" required>
                    </div>
                    <div class="form-group">
                        <label for="item-price">Price:</label>
                        <input type="number" name="item-price[]" step="0.01" required>
                    </div>
                </div>
            </div>
            <button type="button" onclick="addProductFields()">Add Another Product</button>
        </fieldset>
        <button type="submit">Generate Invoice</button>
    </form>
    <div id="invoice-container"></div>
    <button id="download-button" onclick="downloadPDF()">Download PDF</button>
</body>
</html>